{"ast":null,"code":"import { FlattenedSign } from '../flattened/sign.js';\nimport { JWSInvalid } from '../../util/errors.js';\nclass IndividualSignature {\n  constructor(sig, key, options) {\n    this.parent = sig;\n    this.key = key;\n    this.options = options;\n  }\n  setProtectedHeader(protectedHeader) {\n    if (this.protectedHeader) {\n      throw new TypeError('setProtectedHeader can only be called once');\n    }\n    this.protectedHeader = protectedHeader;\n    return this;\n  }\n  setUnprotectedHeader(unprotectedHeader) {\n    if (this.unprotectedHeader) {\n      throw new TypeError('setUnprotectedHeader can only be called once');\n    }\n    this.unprotectedHeader = unprotectedHeader;\n    return this;\n  }\n  addSignature() {\n    return this.parent.addSignature(...arguments);\n  }\n  sign() {\n    return this.parent.sign(...arguments);\n  }\n  done() {\n    return this.parent;\n  }\n}\nexport class GeneralSign {\n  constructor(payload) {\n    this._signatures = [];\n    this._payload = payload;\n  }\n  addSignature(key, options) {\n    const signature = new IndividualSignature(this, key, options);\n    this._signatures.push(signature);\n    return signature;\n  }\n  async sign() {\n    if (!this._signatures.length) {\n      throw new JWSInvalid('at least one signature must be added');\n    }\n    const jws = {\n      signatures: [],\n      payload: ''\n    };\n    for (let i = 0; i < this._signatures.length; i++) {\n      const signature = this._signatures[i];\n      const flattened = new FlattenedSign(this._payload);\n      flattened.setProtectedHeader(signature.protectedHeader);\n      flattened.setUnprotectedHeader(signature.unprotectedHeader);\n      const {\n        payload,\n        ...rest\n      } = await flattened.sign(signature.key, signature.options);\n      if (i === 0) {\n        jws.payload = payload;\n      } else if (jws.payload !== payload) {\n        throw new JWSInvalid('inconsistent use of JWS Unencoded Payload Option (RFC7797)');\n      }\n      jws.signatures.push(rest);\n    }\n    return jws;\n  }\n}","map":{"version":3,"names":["FlattenedSign","JWSInvalid","IndividualSignature","constructor","sig","key","options","parent","setProtectedHeader","protectedHeader","TypeError","setUnprotectedHeader","unprotectedHeader","addSignature","sign","done","GeneralSign","payload","_signatures","_payload","signature","push","length","jws","signatures","i","flattened","rest"],"sources":["C:/Users/hherenu/Desktop/Proyectos/login/node_modules/jose/dist/browser/jws/general/sign.js"],"sourcesContent":["import { FlattenedSign } from '../flattened/sign.js';\r\nimport { JWSInvalid } from '../../util/errors.js';\r\nclass IndividualSignature {\r\n    constructor(sig, key, options) {\r\n        this.parent = sig;\r\n        this.key = key;\r\n        this.options = options;\r\n    }\r\n    setProtectedHeader(protectedHeader) {\r\n        if (this.protectedHeader) {\r\n            throw new TypeError('setProtectedHeader can only be called once');\r\n        }\r\n        this.protectedHeader = protectedHeader;\r\n        return this;\r\n    }\r\n    setUnprotectedHeader(unprotectedHeader) {\r\n        if (this.unprotectedHeader) {\r\n            throw new TypeError('setUnprotectedHeader can only be called once');\r\n        }\r\n        this.unprotectedHeader = unprotectedHeader;\r\n        return this;\r\n    }\r\n    addSignature(...args) {\r\n        return this.parent.addSignature(...args);\r\n    }\r\n    sign(...args) {\r\n        return this.parent.sign(...args);\r\n    }\r\n    done() {\r\n        return this.parent;\r\n    }\r\n}\r\nexport class GeneralSign {\r\n    constructor(payload) {\r\n        this._signatures = [];\r\n        this._payload = payload;\r\n    }\r\n    addSignature(key, options) {\r\n        const signature = new IndividualSignature(this, key, options);\r\n        this._signatures.push(signature);\r\n        return signature;\r\n    }\r\n    async sign() {\r\n        if (!this._signatures.length) {\r\n            throw new JWSInvalid('at least one signature must be added');\r\n        }\r\n        const jws = {\r\n            signatures: [],\r\n            payload: '',\r\n        };\r\n        for (let i = 0; i < this._signatures.length; i++) {\r\n            const signature = this._signatures[i];\r\n            const flattened = new FlattenedSign(this._payload);\r\n            flattened.setProtectedHeader(signature.protectedHeader);\r\n            flattened.setUnprotectedHeader(signature.unprotectedHeader);\r\n            const { payload, ...rest } = await flattened.sign(signature.key, signature.options);\r\n            if (i === 0) {\r\n                jws.payload = payload;\r\n            }\r\n            else if (jws.payload !== payload) {\r\n                throw new JWSInvalid('inconsistent use of JWS Unencoded Payload Option (RFC7797)');\r\n            }\r\n            jws.signatures.push(rest);\r\n        }\r\n        return jws;\r\n    }\r\n}\r\n"],"mappings":"AAAA,SAASA,aAAa,QAAQ,sBAAsB;AACpD,SAASC,UAAU,QAAQ,sBAAsB;AACjD,MAAMC,mBAAmB,CAAC;EACtBC,WAAW,CAACC,GAAG,EAAEC,GAAG,EAAEC,OAAO,EAAE;IAC3B,IAAI,CAACC,MAAM,GAAGH,GAAG;IACjB,IAAI,CAACC,GAAG,GAAGA,GAAG;IACd,IAAI,CAACC,OAAO,GAAGA,OAAO;EAC1B;EACAE,kBAAkB,CAACC,eAAe,EAAE;IAChC,IAAI,IAAI,CAACA,eAAe,EAAE;MACtB,MAAM,IAAIC,SAAS,CAAC,4CAA4C,CAAC;IACrE;IACA,IAAI,CAACD,eAAe,GAAGA,eAAe;IACtC,OAAO,IAAI;EACf;EACAE,oBAAoB,CAACC,iBAAiB,EAAE;IACpC,IAAI,IAAI,CAACA,iBAAiB,EAAE;MACxB,MAAM,IAAIF,SAAS,CAAC,8CAA8C,CAAC;IACvE;IACA,IAAI,CAACE,iBAAiB,GAAGA,iBAAiB;IAC1C,OAAO,IAAI;EACf;EACAC,YAAY,GAAU;IAClB,OAAO,IAAI,CAACN,MAAM,CAACM,YAAY,CAAC,YAAO,CAAC;EAC5C;EACAC,IAAI,GAAU;IACV,OAAO,IAAI,CAACP,MAAM,CAACO,IAAI,CAAC,YAAO,CAAC;EACpC;EACAC,IAAI,GAAG;IACH,OAAO,IAAI,CAACR,MAAM;EACtB;AACJ;AACA,OAAO,MAAMS,WAAW,CAAC;EACrBb,WAAW,CAACc,OAAO,EAAE;IACjB,IAAI,CAACC,WAAW,GAAG,EAAE;IACrB,IAAI,CAACC,QAAQ,GAAGF,OAAO;EAC3B;EACAJ,YAAY,CAACR,GAAG,EAAEC,OAAO,EAAE;IACvB,MAAMc,SAAS,GAAG,IAAIlB,mBAAmB,CAAC,IAAI,EAAEG,GAAG,EAAEC,OAAO,CAAC;IAC7D,IAAI,CAACY,WAAW,CAACG,IAAI,CAACD,SAAS,CAAC;IAChC,OAAOA,SAAS;EACpB;EACA,MAAMN,IAAI,GAAG;IACT,IAAI,CAAC,IAAI,CAACI,WAAW,CAACI,MAAM,EAAE;MAC1B,MAAM,IAAIrB,UAAU,CAAC,sCAAsC,CAAC;IAChE;IACA,MAAMsB,GAAG,GAAG;MACRC,UAAU,EAAE,EAAE;MACdP,OAAO,EAAE;IACb,CAAC;IACD,KAAK,IAAIQ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACP,WAAW,CAACI,MAAM,EAAEG,CAAC,EAAE,EAAE;MAC9C,MAAML,SAAS,GAAG,IAAI,CAACF,WAAW,CAACO,CAAC,CAAC;MACrC,MAAMC,SAAS,GAAG,IAAI1B,aAAa,CAAC,IAAI,CAACmB,QAAQ,CAAC;MAClDO,SAAS,CAAClB,kBAAkB,CAACY,SAAS,CAACX,eAAe,CAAC;MACvDiB,SAAS,CAACf,oBAAoB,CAACS,SAAS,CAACR,iBAAiB,CAAC;MAC3D,MAAM;QAAEK,OAAO;QAAE,GAAGU;MAAK,CAAC,GAAG,MAAMD,SAAS,CAACZ,IAAI,CAACM,SAAS,CAACf,GAAG,EAAEe,SAAS,CAACd,OAAO,CAAC;MACnF,IAAImB,CAAC,KAAK,CAAC,EAAE;QACTF,GAAG,CAACN,OAAO,GAAGA,OAAO;MACzB,CAAC,MACI,IAAIM,GAAG,CAACN,OAAO,KAAKA,OAAO,EAAE;QAC9B,MAAM,IAAIhB,UAAU,CAAC,4DAA4D,CAAC;MACtF;MACAsB,GAAG,CAACC,UAAU,CAACH,IAAI,CAACM,IAAI,CAAC;IAC7B;IACA,OAAOJ,GAAG;EACd;AACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}